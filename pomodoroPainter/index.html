<!DOCTYPE html>
<html>
<head>
	<title>Pomodoro Painter</title>
	<link rel="stylesheet" type="text/css" href="style.css" />
	<link href='http://fonts.googleapis.com/css?family=Kalam|Yesteryear' rel='stylesheet' type='text/css'>
	<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.9.24/paper-full.js'></script>
	<script type="text/paperscript" canvas='myCanvas' async>
	var path;
	var idleTime = 0;
	// hide the second canvas from view
	$('.second').hide();

	function onMouseDown(event) {
		path = new Path();
		path.fillColor = {
			hue: Math.random() * 360,
			saturation: 1,
			brightness: 1,
			opacity: 0.5
		};
		path.add(event.point);
		idleTime = 0;
	}

	function onMouseDrag(event) {
		var paintPoints = event.delta / 2;
		paintPoints.angle += 90;

		var top = event.middlePoint + paintPoints;
		var bottom = event.middlePoint - paintPoints;

		path.add(top);
		path.insert(0, bottom);
		idleTime = 0;
	}

	function onMouseUp(event) {
		path.add(event.point);
		path.closed = true;
		var children = project.activeLayer.children;
		path.smooth();
		path.simplify();
		project.activeLayer.lastChild.blendMode = 'multiply';
		idleTime = 0;
		// start making the strokes fade after 5 strokes
		for( var i= 0; i < (children.length - 5); i++) {
			children[i].opacity = 0.5;
		}
		// start removing strokes after 15 strokes
		for(var j = 0; j < (children.length - 15); j++) {
			children[j].visible = false;
		}
	}
	// button to clear the board
	$('#clearBtn').on('click', function() {
		project.clear();
	})

	//set a timer for the idle counter.
	setInterval(idleTimer, 1000);
	// When the canvas is idle for 45 seconds, clear it.
	function idleTimer() {
		idleTime = idleTime + 1;
		if(idleTime > 45) {
			$('#myCanvas').fadeOut(2000, function() {
				project.clear();
				$('#myCanvas').fadeIn('slow');
				return idleTime = 0;
			});
		}
	}

	// function to clear the canvas after 5 minutes
	function clearBoard() {
		$('#myCanvas').fadeOut(2000, function() {
			project.clear();
			$('#myCanvas').fadeIn('slow');
		});
	}

	// set the timer to clear after 5 minutes.
	setInterval(clearBoard, 300000);

	</script>
</head>
<body>
	<img id='background' src='capeCod.jpg' alt='A view of cape cod beach' />
	<section id='buttons'>
		<h2>Pomodoro Painter</h2>
		<p>Paint will fade in 5 minutes so create on a whim without concern of the outcome</p>
		<button id='clearBtn'>Clear Board</button>
	</section>
	<section id="canvasStn">
		<canvas id='myCanvas' height='600' width='1150'></canvas>
		<canvas id='myCanvas' class='second' height='600' width='1150'></canvas>
	</section>
</body>
</html>
